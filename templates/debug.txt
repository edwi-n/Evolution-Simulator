<!DOCTYPE html>
<html>

<head>
          <style>
                    body {
                              background-color: grey;
                              color: white
                    }
          </style>
</head>

<body>
          <h1 id="title">Evolution Simulator</h1>
          <div id="simulation-main">
                    <div id="simulation-info"></div>
                    <canvas id="simulation-grid" width="1000" height="1000"></canvas>
                    <!-- <div id="simulation-grid"></div> -->
                    <div id="simulation-progress"></div>
                    <div id="selected-organism-info"></div>
          </div>
          </div>
</body>

</html>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>
          var data = JSON.parse('{{data | tojson | safe}}')
          const canvas = document.getElementById("simulation-grid")
          const ctx = canvas.getContext("2d")
          ctx.fillStyle = "white"
          ctx.fillRect(0, 0, 1000, 1000)
          prev = {}
          async function loop() {
                    var j = 0
                    var i = 1
                    while (j < data.movement.length) {
                              if (j % 1000 == 0) {
                                        await new Promise(r => setTimeout(r, 10));
                              }
                              if (data.movement[j][0] == -1) {
                                        ctx.fillRect(0, 0, 1000, 1000)
                                        j += 1;
                                        i += 1
                                        continue;
                              }
                              if (data.movement[j][0] in prev) {
                                        ctx.fillRect(prev[data.movement[j][0]][0] * 10, prev[data.movement[j][0]][1] * 10, 10, 10)
                              }
                              ctx.clearRect(data.movement[j][1][1] * 10, data.movement[j][1][0] * 10, 10, 10)
                              prev[data.movement[j][0]] = [data.movement[j][1][1], [data.movement[j][1][0]]]
                              document.getElementById("simulation-progress").innerHTML = i
                              j += 1
                    }
          }
          loop()
</script>